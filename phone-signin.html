<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Sign-In</title>

    <!-- ✅ Firebase compat SDK (LOAD THESE FIRST) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <!-- ✅ Firebase Config (NO `import` needed) -->
    <script src="firebaseConfig.js"></script>
</head>
<body>
    <h2>Phone Sign-In</h2>
    <input type="text" id="phone" placeholder="+91 9876543210">
    <div id="recaptcha-container"></div>
    <button id="sendOTP">Send OTP</button>
    
    <input type="text" id="otp" placeholder="Enter OTP">
    <button id="verifyOTP">Verify OTP</button>
    
    <p id="error-message" style="color: red;"></p>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            try {
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier("recaptcha-container", {
                    size: "invisible",
                    callback: function (response) {
                        console.log("reCAPTCHA verified:", response);
                    },
                    "expired-callback": function () {
                        console.log("reCAPTCHA expired, please refresh.");
                    }
                });
            } catch (error) {
                console.error("Error initializing reCAPTCHA:", error);
                document.getElementById("error-message").innerText = "Error initializing reCAPTCHA. Please try again.";
            }
        });

        document.getElementById("sendOTP").addEventListener("click", function () {
            var phoneNumber = document.getElementById("phone").value;
            var appVerifier = window.recaptchaVerifier;

            firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
                .then(function (confirmationResult) {
                    window.confirmationResult = confirmationResult;
                    alert("OTP Sent!");
                }).catch(function (error) {
                    console.error("Error sending OTP:", error);
                    document.getElementById("error-message").innerText = "Error sending OTP. Please check your number.";
                });
        });

        document.getElementById("verifyOTP").addEventListener("click", function () {
    var code = document.getElementById("otp").value;

    window.confirmationResult.confirm(code)
        .then(function (result) {
            alert("✅ Phone Number Verified!");
            
            // ✅ Redirect to the main page after successful verification
            window.location.href = "index.html";  
        })
        .catch(function (error) {
            console.error("❌ Error verifying OTP:", error);
            document.getElementById("error-message").innerText = "Invalid OTP. Please try again.";
        });
});

    </script>
</body>
</html>
